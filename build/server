#!/usr/bin/python3
from db.server import TCPHandler, socketserver
from db.database import Database
from functools import partial
import sys

if __name__ == "__main__":
    HOST, PORT = "localhost", 0
    if(len(sys.argv) == 2):
        PORT = int(sys.argv[1])
        password = "admin"
    elif(len(sys.argv) == 3):
        PORT = int(sys.argv[1])
        password = sys.argv[2]
    else:
        print("usage : ./server port [password]")
    if(PORT < 1024 or PORT > 65535):
        exit()

    database = Database(password)
    # https://stackoverflow.com/a/52046062
    server = socketserver.TCPServer
    handler = partial(TCPHandler, database, server)
    server = socketserver.TCPServer((HOST, PORT), handler)
    
    while True:
        server.handle_request()
